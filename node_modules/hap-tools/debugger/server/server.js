"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(o,p){try{var i=r[o](p),a=i.value}catch(e){return void t(e)}if(!i.done)return Promise.resolve(a).then(function(e){n("next",e)},function(e){n("throw",e)});e(a)}return n("next")})}}function httpServerErrHandler(e){e.on("error",function(e){_utils.colorconsole.error("### App Server ### Error occure:\n"+JSON.stringify(e)+"\n"),"EADDRINUSE"===e.code&&_utils.colorconsole.error("### App Server ### 端口"+_env.webAppEnv.PORT+" 被占用, 请检查")})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.startServer=void 0;var startServer=exports.startServer=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var r,t,n,o,p,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,r=_http2.default.Server(_app2.default.callback()),t=!0,n=!1,o=void 0,e.prev=5,p=_app2.default.context.mountedRouters[Symbol.iterator]();case 7:if(t=(i=p.next()).done){e.next=15;break}if(a=i.value,"function"!=typeof a.default.beforeStart){e.next=12;break}return e.next=12,a.default.beforeStart(r,_app2.default);case 12:t=!0,e.next=7;break;case 15:e.next=21;break;case 17:e.prev=17,e.t0=e.catch(5),n=!0,o=e.t0;case 21:e.prev=21,e.prev=22,!t&&p.return&&p.return();case 24:if(e.prev=24,!n){e.next=27;break}throw o;case 27:return e.finish(24);case 28:return e.finish(21);case 29:httpServerErrHandler(r),r.listen(_env.webAppEnv.PORT,function(){_utils.colorconsole.info("### App Server ### server started at http://localhost"+("80"!==_env.webAppEnv.PORT?":"+_env.webAppEnv.PORT+"/":"/")),_utils.colorconsole.info("### App Server ### 请确保手机与App Server处于相同网段");var e="http://"+(0,_utils.getIPv4IPAddress)()+":"+_env.webAppEnv.PORT;(0,_utils.outputQRCodeOnTerminal)(e)}),process.on("SIGINT",function(){_utils.colorconsole.info("### App Server ### SIGINT signal recevied!"),_utils.colorconsole.info("### App Server ### 退出进程 pid: "+process.pid),process.exit()}),e.next=37;break;case 34:e.prev=34,e.t1=e.catch(0),_utils.colorconsole.error("### App Server ### 启动App Server失败.\n"+JSON.stringify(e.t1));case 37:case"end":return e.stop()}},e,this,[[0,34],[5,17,21,29],[22,,24,28]])}));return function(){return e.apply(this,arguments)}}(),_http=require("http"),_http2=_interopRequireDefault(_http),_app=require("./app"),_app2=_interopRequireDefault(_app),_utils=require("../lib/utils"),_env=require("./env");