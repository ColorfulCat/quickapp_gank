"use strict";module.exports=function(e){function i(e,i){e.parent.children=o.react.buildChildren(e.parent);var n=r(e.node.name),s=[],a=void 0;o.isIdentifier(n)?(a=n.name,s.push(o.stringLiteral(a))):s.push(n);var l=e.node.attributes;return l=l.length?t(l,i):o.nullLiteral(),s.push(l),o.callExpression(o.identifier("__elem"),s)}function n(e,i,n){var r=[];return r.push(o.stringLiteral(e)),r.push(o.objectExpression([o.objectProperty(o.identifier("value"),o.callExpression(o.identifier("__s"),[o.stringLiteral(i)]))])),o.callExpression(o.identifier("__elem"),r)}function r(e){return o.isJSXIdentifier(e)&&(e.type="Identifier"),e}function t(e,i){function n(){r.length&&(t.push(o.objectExpression(r)),r=[])}for(var r=[],t=[],a=!1;e.length;){var l=e.shift();o.isJSXSpreadAttribute(l)?(n(),a=!0,t.push(l.argument)):r.push(s(l))}return n(),a?(t.unshift(o.objectExpression([])),e=o.callExpression(o.identifier("__extend"),t)):e=t[0],e}function s(e){var i=a(e.value||o.booleanLiteral(!0));return o.isStringLiteral(i)&&!o.isJSXExpressionContainer(e.value)&&(i.value=i.value.replace(/\n\s+/g," ")),o.isValidIdentifier(e.name.name)?e.name.type="Identifier":e.name=o.stringLiteral(e.name.name),o.inherits(o.objectProperty(e.name,i),e)}function a(e){return o.isJSXExpressionContainer(e)?e.expression:e}var o=e.types;return{inherits:require("babel-plugin-syntax-jsx"),visitor:{JSXNamespacedName:function(e){throw e.buildCodeFrameError("不支持带命名空间的标签/属性")},JSXElement:{exit:function(e,t){var s=i(e.get("openingElement"),t),a=r(e.get("openingElement").node.name),l=void 0;o.isIdentifier(a)&&(l=a.name);var u=e.node.children.map(function(e){return o.isStringLiteral(e)?n("text"===l?"span":"text",e.value,t):e});s.arguments.push(o.arrayExpression(u)),e.replaceWith(o.inherits(s,e.node))}},Program:function(e){e.traverse({"ObjectMethod|FunctionExpression|ClassMethod":function(e){var i={hasJsx:!1};e.traverse({JSXElement:function(){this.hasJsx=!0}},i),i.hasJsx&&(e.get("body").unshiftContainer("body",o.variableDeclaration("const",[o.variableDeclarator(o.identifier("__s"),o.memberExpression(o.thisExpression(),o.identifier("$stringify")))])),e.get("body").unshiftContainer("body",o.variableDeclaration("const",[o.variableDeclarator(o.identifier("__extend"),o.memberExpression(o.thisExpression(),o.identifier("$extend")))])),e.get("body").unshiftContainer("body",o.variableDeclaration("const",[o.variableDeclarator(o.identifier("__elem"),o.memberExpression(o.thisExpression(),o.identifier("$createElement")))])))}})}}}};