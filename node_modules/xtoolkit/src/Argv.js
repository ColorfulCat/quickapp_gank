/**
 * Created by exolution on 17/1/4.
 */
class Argv {
    constructor(args, def) {
        this.def = def;
        this._options = [];
        this._params = [];
        let reg = /^-{1,2}/;
        for (var i = 0; i < args.length; i++) {
            var arg = args[i];
            if (reg.test(arg)) {
                this._completePrevOption(true);
                let [name,value]=arg.replace(reg, '').split('=');
                this._addOption(name, arg, value);

            }
            else {
                if (!this._completePrevOption(arg)) {
                    this._params.push(arg)
                }
            }
        }
        this._completePrevOption(true);
    }

    _hasPrevOption() {
        return this._options.length > 0 && this._options[this._options.length - 1].value === undefined;
    }

    _completePrevOption(value) {
        if (this._hasPrevOption()) {
            let option = this._options[this._options.length - 1];
            option.value = value;
            this[option.name] = value;
            return true;
        }
        return false;
    }

    _addOption(name, text, value) {
        var known = false;
        if (this.def && this.def[name]) {
            known = true;
            if (this.def[name].type == 'boolean') {
                value = true;
            }
        }
        this._options.push({name, value, text, known});
        this[name] = value;
    }
}
module.exports = Argv;